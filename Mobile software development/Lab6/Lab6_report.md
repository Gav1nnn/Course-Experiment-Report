# 2025年夏季《移动软件开发》实验报告



<center>姓名：张家玮  学号：23020007157</center>

| 姓名和学号？         | 张家玮，23020007157                                 |
| -------------------- | --------------------------------------------------- |
| 本实验属于哪门课程？ | 中国海洋大学25夏《移动软件开发》                    |
| 实验名称？           | 实验6：推箱子游戏                                   |
| 博客地址？           | 暂无                                                |
| Github仓库地址？     | https://github.com/Gav1nnn/Course-Experiment-Report |

（备注：将实验报告发布在博客、代码公开至 github 是 **加分项**，不是必须做的）

## 一、实验目标

1. 综合应用前几次实验所学的知识，完成一个完整的推箱子小游戏；
2. 熟练掌握微信小程序的开发流程，包括页面逻辑、资源加载与渲染；
3. 掌握在开发过程中使用 **真机预览** 和 **调试工具** 的方法；
4. 提高对程序结构化设计与调试能力的理解。

------

## 二、实验步骤

1. **项目初始化**

   - 使用微信开发者工具创建小程序项目；
   - 配置 `app.json`，定义首页与游戏页面。

2. **地图与关卡设计**

   - 在 `data.js` 中定义 4 个 8×8 的二维数组，用来表示关卡地图；

   例如：

   ```js
   //地图数据:1为墙、2为路、3为终点、4为箱子、5为人物、0为墙的外围
   var map1 = [
     [0, 1, 1, 1, 1, 1, 0, 0],
     [0, 1, 2, 2, 1, 1, 1, 0],
     [0, 1, 5, 4, 2, 2, 1, 0],
     [1, 1, 1, 2, 1, 2, 1, 1],
     [1, 3, 1, 2, 1, 2, 2, 1],
     [1, 3, 4, 2, 2, 1, 2, 1],
     [1, 3, 2, 2, 2, 4, 2, 1],
     [1, 1, 1, 1, 1, 1, 1, 1]
   ]
   ```

   - 使用 `map` 数组存储墙体、地板等信息，`box` 数组存储箱子的位置。

3. **游戏逻辑编写**

   - 定义角色（小鸟）的初始位置；
   - 实现 `up`、`down`、`left`、`right` 四个移动函数：
     - 如果目标位置为空，则角色直接移动；
     - 如果目标位置是箱子，则检测箱子下一格是否为空，若为空则推动箱子并移动角色。
   - 在每次移动后调用 `drawCanvas()`，刷新界面显示。

   如下：

   ```js
     up: function() {
     //不在最顶端才考虑上移
       if (row > 0) {
       //如果上方不是墙或箱子,可以移动小鸟
         if (map[row - 1] [col] != 1 && box[row - 1][col] != 4) {
         //更新当前小鸟的坐标
           row = row- 1
         }
         //如果上方是箱子.
         else if (box[row- 1][col] == 4) {
         //箱子不在最顶端才能考虑推动
           if (row- 1> 0) {
           //如果箱子上方不是墙或箱子
             if (map[row - 2][col] != 1 && box[ row- 2][col] != 4) {
               box[row - 2][col] = 4
               box[row - 1] [col] = 0
               //更新当前小鸟的坐标
               row = row- 1
             }
           }
         } 
         this.drawCanvas()
         this.checkWin()
       }
   },
   ```

4. **页面跳转与关卡管理**

   - 在 `index` 页面选择关卡难度，使用 `wx.navigateTo` 跳转到 `game` 页面；

   ```js
     // choose level
     chooseLevel:function(e) {
       let level = e.currentTarget.dataset.level
       wx.navigateTo({
         url:`../game/game?level=${level} `
       })
     },
   ```

   - 在 `game.js` 中根据关卡参数加载不同的地图。

   ```js
    // 绘制地图
     drawCanvas:function(){
       let ctx = this.ctx
       // 清空画布
       ctx.clearRect(0, 0, 320, 320)
       // 绘制8x8地图
       for (var i=0; i<8; i++){
         for (var j=0; j<8; j++){
           // 默认是道路
           let img = 'ice'
           if(map[i][j]==1){
             img = 'stone'
           }else if (map[i][j]==3){
             img = 'pig'
           }
   
           // 绘制地图
           ctx.drawImage('/images/icons/'+img+'.png', j*w, i*w, w, w)
   
           if(box[i][j]==4){
             ctx.drawImage('/images/icons/box.png', j*w, i*w, w, w)
           }
         }
       }
       // 叠加绘制小鸟
       ctx.drawImage('/images/icons/bird.png', col*w, row*w, w, w)
   
       ctx.draw()
     },
   ```

   

5. **真机调试与测试**

   - 通过微信开发者工具进行模拟器调试；
   - 使用手机真机预览，测试操作灵敏度与界面显示是否正常；
   - 调整地图边界判定、箱子碰撞逻辑等细节。

------

## 三、程序运行结果

1. 打开小程序，进入首页，能够选择关卡；

<img src="/Users/zhanggavin/Pictures/Screenshot/截屏2025-09-08 19.18.31.png" alt="截屏2025-09-08 19.18.31" style="zoom: 25%;" />

2. 进入游戏页面后，显示 8×8 的推箱子地图；

<img src="/Users/zhanggavin/Pictures/Screenshot/截屏2025-09-08 19.18.43.png" alt="截屏2025-09-08 19.18.43" style="zoom:25%;" />

3. 通过上下左右按钮（或手势）控制角色移动，角色可推动箱子；

4. 四个关卡均能正常加载，地图边界和碰撞检测逻辑正确；

<img src="/Users/zhanggavin/Pictures/Screenshot/截屏2025-09-08 19.19.30.png" alt="截屏2025-09-08 19.19.30" style="zoom:25%;" />

5. 游戏运行流畅，在真机上可正常预览与操作。

------

## 四、问题总结与体会

1. **问题总结**
   - 在实现页面跳转时，一开始写成 `wx:navigateTo`，导致报错，修改为 `wx.navigateTo` 才解决；
   - 在地图初始化时曾出现 `map1 is not defined` 与 `Cannot read property '0' of undefined` 错误，原因是数组未正确导入或初始化；
   - 推箱子逻辑中需要考虑边界情况，否则容易出现数组越界。
2. **体会**
   - 本次实验让我第一次完整实现了一个小游戏，对 **二维数组、事件处理与页面渲染** 有了更深入的理解；
   - 学会了在小程序中处理用户交互与游戏逻辑，并能够利用真机调试快速定位错误；
   - 四个关卡的制作加深了我对程序模块化设计的认识，也让我体会到测试与调试在开发中的重要性；
   - 本次实验不仅提升了编程能力，也增强了我对小程序开发的兴趣。
